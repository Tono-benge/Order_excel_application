// ============================================================================
// ORDER PROVIDER - State Management –¥–ª—è –∑–∞–∫–∞–∑–æ–≤ (Frontend)
// ============================================================================
// –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∑–∞–∫–∞–∑–æ–≤ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π:
// - –ó–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–æ–≤ –∏–∑ API (–≤—Å–µ –∑–∞–∫–∞–∑—ã –∏–ª–∏ –∑–∞–∫–∞–∑—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
// - –°–æ–∑–¥–∞–Ω–∏—è, –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤
// - –ü–æ–∏—Å–∫–∞ –ø–æ –Ω–æ–º–µ—Ä—É –∑–∞–∫–∞–∑–∞, –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å—É–º–º–µ
// - –§–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
// - –ü–∞–≥–∏–Ω–∞—Ü–∏–∏ (—Ä–∞–∑–±–∏–≤–∫–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ 15 —ç–ª–µ–º–µ–Ω—Ç–æ–≤)
// –°–≤—è–∑—å —Å –ë–î: –ß–µ—Ä–µ–∑ ApiService ‚Üí Alfred Server ‚Üí SQLite Table2
// ============================================================================

// ----------------------------------------------------------------------------
// –ë–õ–û–ö –ò–ú–ü–û–†–¢–û–í
// ----------------------------------------------------------------------------

// ChangeNotifier - –∫–ª–∞—Å—Å –∏–∑ Flutter –¥–ª—è –ø–∞—Ç—Ç–µ—Ä–Ω–∞ Observer
// –ü–æ–∑–≤–æ–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª—è—Ç—å UI –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ notifyListeners()
import 'package:flutter/foundation.dart';

// OrderModel - –º–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–∞ (orderId, orderAmount, userForeignKey)
// –§–∞–π–ª: lib/models/order_model.dart
import '../models/order_model.dart';

// ApiService - —Å–µ—Ä–≤–∏—Å –¥–ª—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Alfred —Å–µ—Ä–≤–µ—Ä—É
// –§–∞–π–ª: lib/services/api_service.dart
import '../services/api_service.dart';

// ----------------------------------------------------------------------------
// –ö–õ–ê–°–° PROVIDER
// ----------------------------------------------------------------------------
// ChangeNotifier - –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–∏–¥–∂–µ—Ç–∞–º –ø–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è
// with - –ø—Ä–∏–º–µ—à–∏–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å (mixin)

class OrderProvider with ChangeNotifier {
  
  // ==========================================================================
  // –ë–õ–û–ö: –ü–ï–†–ï–ú–ï–ù–ù–´–ï –°–û–°–¢–û–Ø–ù–ò–Ø (State Variables)
  // ==========================================================================
  // ‚úÖ –ë–ï–ó final - —ç—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –±—É–¥—É—Ç –∏–∑–º–µ–Ω—è—Ç—å—Å—è
  // ‚úÖ –ë–ï–ó _ (–ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏) - –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å —Ç–≤–æ–∏–º –∫–æ–¥–æ–º
  
  // ApiService - —ç–∫–∑–µ–º–ø–ª—è—Ä —Å–µ—Ä–≤–∏—Å–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API
  // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤—Å–µ—Ö HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ (GET, POST, PUT, DELETE)
  ApiService apiService = ApiService();
  
  // orders - —Å–ø–∏—Å–æ–∫ –í–°–ï–• –∑–∞–∫–∞–∑–æ–≤ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤)
  // –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ —á–µ—Ä–µ–∑ fetchOrders() –∏–ª–∏ fetchUserOrders()
  List<OrderModel> orders = [];
  
  // filteredOrders - —Å–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ –ü–û–°–õ–ï –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤/–ø–æ–∏—Å–∫–∞
  // –≠—Ç–æ —Ç–æ, —á—Ç–æ –≤–∏–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ —ç–∫—Ä–∞–Ω–µ
  List<OrderModel> filteredOrders = [];
  
  // isLoading - —Ñ–ª–∞–≥ –∑–∞–≥—Ä—É–∑–∫–∏ (true –∫–æ–≥–¥–∞ –∏–¥—ë—Ç –∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É)
  // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–æ–∫–∞–∑–∞ CircularProgressIndicator –≤ UI
  bool isLoading = false;
  
  // errorMessage - —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏ (null –µ—Å–ª–∏ –æ—à–∏–±–æ–∫ –Ω–µ—Ç)
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –µ—Å–ª–∏ –∑–∞–ø—Ä–æ—Å —É–ø–∞–ª
  String? errorMessage;
  
  // searchQuery - —Ç–µ–∫—É—â–∏–π –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –∏–∑ SearchBarWidget
  // –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ = –ø–æ–∏—Å–∫ –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –∑–∞–∫–∞–∑—ã
  String searchQuery = '';
  
  // selectedUserId - ID –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
  // null = –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–∫–∞–∑—ã –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  // –ß–∏—Å–ª–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä 1) = –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –∑–∞–∫–∞–∑—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å ID=1
  int? selectedUserId;
  
  // -------------------------------------------------------------------------
  // –ü–ê–ì–ò–ù–ê–¶–ò–Ø (Pagination)
  // -------------------------------------------------------------------------
  
  // currentPage - –Ω–æ–º–µ—Ä —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 0)
  // –°—Ç—Ä–∞–Ω–∏—Ü–∞ 0 = —ç–ª–µ–º–µ–Ω—Ç—ã 0-14, —Å—Ç—Ä–∞–Ω–∏—Ü–∞ 1 = —ç–ª–µ–º–µ–Ω—Ç—ã 15-29 –∏ —Ç.–¥.
  int currentPage = 0;
  
  // itemsPerPage - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤ –Ω–∞ –æ–¥–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ (–∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞)
  // ‚úÖ final - –Ω–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (—ç—Ç–æ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞)
  final int itemsPerPage = 15;

  // ==========================================================================
  // –ë–õ–û–ö: –í–´–ß–ò–°–õ–Ø–ï–ú–´–ï –ì–ï–¢–¢–ï–†–´ (Computed Getters)
  // ==========================================================================
  // –≠—Ç–∏ –≥–µ—Ç—Ç–µ—Ä—ã –≤—ã—á–∏—Å–ª—è—é—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ –ª–µ—Ç—É –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏
  
  // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü
  // ceil() - –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –≤–≤–µ—Ä—Ö (17 –∑–∞–∫–∞–∑–æ–≤ / 15 = 1.13 ‚Üí 2 —Å—Ç—Ä–∞–Ω–∏—Ü—ã)
  int get totalPages => (filteredOrders.length / itemsPerPage).ceil();
  
  // –ó–∞–∫–∞–∑—ã –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã (slice —Å–ø–∏—Å–∫–∞)
  List<OrderModel> get paginatedOrders {
    // startIndex - –∏–Ω–¥–µ–∫—Å –ø–µ—Ä–≤–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    // –ù–∞–ø—Ä–∏–º–µ—Ä: —Å—Ç—Ä–∞–Ω–∏—Ü–∞ 0 ‚Üí 0*15=0, —Å—Ç—Ä–∞–Ω–∏—Ü–∞ 1 ‚Üí 1*15=15
    final startIndex = currentPage * itemsPerPage;
    
    // endIndex - –∏–Ω–¥–µ–∫—Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ + 1
    // clamp() - –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º [0, –¥–ª–∏–Ω–∞ —Å–ø–∏—Å–∫–∞]
    // –ó–∞—â–∏—Ç–∞ –æ—Ç –≤—ã—Ö–æ–¥–∞ –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã –º–∞—Å—Å–∏–≤–∞
    final endIndex = (startIndex + itemsPerPage).clamp(0, filteredOrders.length);
    
    // sublist() - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —á–∞—Å—Ç—å —Å–ø–∏—Å–∫–∞ [startIndex, endIndex)
    return filteredOrders.sublist(startIndex, endIndex);
  }
  
  // –û–±—â–∞—è —Å—É–º–º–∞ –≤—Å–µ—Ö –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤
  double get totalAmount {
    // –ï—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –ø—É—Å—Ç–æ–π - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º 0
    if (filteredOrders.isEmpty) return 0.0;
    
    // fold() - —Å–≤—ë—Ä—Ç–∫–∞ —Å–ø–∏—Å–∫–∞ (–∞–≥—Ä–µ–≥–∞—Ü–∏—è)
    // 0.0 - –Ω–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å—É–º–º—ã
    // (sum, order) => sum + order.orderAmount - —Ñ—É–Ω–∫—Ü–∏—è —Å–ª–æ–∂–µ–Ω–∏—è
    return filteredOrders.fold(0.0, (sum, order) => sum + order.orderAmount);
  }

  // ==========================================================================
  // –ë–õ–û–ö: –ú–ï–¢–û–î–´ –ó–ê–ì–†–£–ó–ö–ò –î–ê–ù–ù–´–• (Data Fetching Methods)
  // ==========================================================================
  
  // ---------------------------------------------------------------------------
  // –ú–ï–¢–û–î: –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ –∑–∞–∫–∞–∑—ã –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
  // ---------------------------------------------------------------------------
  // async - –º–µ—Ç–æ–¥ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π (–º–æ–∂–µ—Ç –∂–¥–∞—Ç—å –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞)
  // Future<void> - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç Promise –∫–æ—Ç–æ—Ä—ã–π –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–Ω–∞—á–µ–Ω–∏—è
  
  Future<void> fetchOrders() async {
    // –®–∞–≥ 1: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ –∑–∞–≥—Ä—É–∑–∫–∏
    isLoading = true;
    errorMessage = null; // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—É—é –æ—à–∏–±–∫—É
    notifyListeners(); // –£–≤–µ–¥–æ–º–ª—è–µ–º UI ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
    
    try {
      // –®–∞–≥ 2: –í—ã–ø–æ–ª–Ω—è–µ–º HTTP GET –∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É
      // await - –∂–¥—ë–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ–º UI)
      // getOrders() ‚Üí GET http://localhost:8080/api/orders
      orders = await apiService.getOrders();
      
      // –®–∞–≥ 3: –ö–æ–ø–∏—Ä—É–µ–º –≤—Å–µ –∑–∞–∫–∞–∑—ã –≤ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫
      // List.from() - —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π —Å–ø–∏—Å–æ–∫ (–∫–æ–ø–∏—è)
      filteredOrders = List.from(orders);
      
      // –®–∞–≥ 4: –°–±—Ä–∞—Å—ã–≤–∞–µ–º –Ω–∞ –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
      currentPage = 0;
      
    } catch (e) {
      // catch - –ª–æ–≤–∏–º –ª—é–±—É—é –æ—à–∏–±–∫—É (–Ω–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞, —Å–µ—Ä–≤–µ—Ä —É–ø–∞–ª –∏ —Ç.–¥.)
      // e.toString() - —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏ –¥–ª—è –ø–æ–∫–∞–∑–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
      errorMessage = e.toString();
      
      // –û—á–∏—â–∞–µ–º —Å–ø–∏—Å–∫–∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ
      orders = [];
      filteredOrders = [];
      
    } finally {
      // finally - –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ (—É—Å–ø–µ—Ö –∏–ª–∏ –æ—à–∏–±–∫–∞)
      isLoading = false; // –£–±–∏—Ä–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
      notifyListeners(); // –û–±–Ω–æ–≤–ª—è–µ–º UI (–ø–æ–∫–∞–∑–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–ª–∏ –æ—à–∏–±–∫—É)
    }
  }

  // ---------------------------------------------------------------------------
  // –ú–ï–¢–û–î: –ó–∞–≥—Ä—É–∑–∏—Ç—å –∑–∞–∫–∞–∑—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  // ---------------------------------------------------------------------------
  // userId - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Table1 (–Ω–∞–ø—Ä–∏–º–µ—Ä: 1, 2, 3)
  
  Future<void> fetchUserOrders(int userId) async {
    isLoading = true;
    errorMessage = null;
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
    selectedUserId = userId;
    notifyListeners();
    
    try {
      // getUserOrders() ‚Üí GET http://localhost:8080/api/users/:id/orders
      orders = await apiService.getUserOrders(userId);
      filteredOrders = List.from(orders);
      currentPage = 0;
      
    } catch (e) {
      errorMessage = e.toString();
      orders = [];
      filteredOrders = [];
    } finally {
      isLoading = false;
      notifyListeners();
    }
  }

  // ==========================================================================
  // –ë–õ–û–ö: –ú–ï–¢–û–î–´ –ò–ó–ú–ï–ù–ï–ù–ò–Ø –î–ê–ù–ù–´–• (Data Mutation Methods)
  // ==========================================================================
  
  // ---------------------------------------------------------------------------
  // –ú–ï–¢–û–î: –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∑–∞–∫–∞–∑
  // ---------------------------------------------------------------------------
  // amount - —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 2500.0)
  // userId - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Table1 (–∫–æ–º—É –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –∑–∞–∫–∞–∑)
  
  Future<void> createOrder(double amount, int userId) async {
    isLoading = true;
    errorMessage = null;
    notifyListeners();
    
    try {
      // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ (–≤–∏–¥–Ω–æ –≤ –∫–æ–Ω—Å–æ–ª–∏)
      print('üì§ OrderProvider: –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞');
      print('üì§ Amount: $amount, UserId: $userId');
      
      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º POST –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
      // createOrder() ‚Üí POST http://localhost:8080/api/orders
      // –°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—ë—Ç —Å–æ–∑–¥–∞–Ω–Ω—ã–π –∑–∞–∫–∞–∑ —Å –Ω–æ–≤—ã–º ID
      final newOrder = await apiService.createOrder(amount, userId);
      
      print('üì• OrderProvider: –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç: ${newOrder.orderId}');
      
      // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –∑–∞–∫–∞–∑ –≤ –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫
      // –ß—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞—Ç—å –≤—Å–µ –∑–∞–∫–∞–∑—ã —Å —Å–µ—Ä–≤–µ—Ä–∞
      orders.add(newOrder);
      
      // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã/–ø–æ–∏—Å–∫ –∑–∞–Ω–æ–≤–æ
      // –ù–æ–≤—ã–π –∑–∞–∫–∞–∑ –ø–æ—è–≤–∏—Ç—Å—è –µ—Å–ª–∏ –ø—Ä–æ—Ö–æ–¥–∏—Ç —Ñ–∏–ª—å—Ç—Ä
      applyFilters();
      
      print('‚úÖ OrderProvider: –ó–∞–∫–∞–∑ –¥–æ–±–∞–≤–ª–µ–Ω –≤ —Å–ø–∏—Å–æ–∫');
      
    } catch (e, stackTrace) {
      // stackTrace - –ø–æ–ª–Ω–∞—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ —Å—Ç–µ–∫–∞ –≤—ã–∑–æ–≤–æ–≤ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
      print('‚ùå OrderProvider ERROR: $e');
      print('‚ùå StackTrace: $stackTrace');
      
      errorMessage = e.toString();
      
      // rethrow - –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –≤—ã—à–µ (–≤ UI —Å–ª–æ–π)
      // –ß—Ç–æ–±—ã UI –º–æ–≥ –ø–æ–∫–∞–∑–∞—Ç—å SnackBar —Å –æ—à–∏–±–∫–æ–π
      rethrow;
      
    } finally {
      isLoading = false;
      notifyListeners();
    }
  }

  // ---------------------------------------------------------------------------
  // –ú–ï–¢–û–î: –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–∫–∞–∑
  // ---------------------------------------------------------------------------
  // orderId - ID –∑–∞–∫–∞–∑–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
  // amount - –Ω–æ–≤–∞—è —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞
  // userId - –Ω–æ–≤—ã–π ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  
  Future<void> updateOrder(int orderId, double amount, int userId) async {
    isLoading = true;
    errorMessage = null;
    notifyListeners();
    
    try {
      print('üìù OrderProvider: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ ID: $orderId');
      
      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º PUT –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
      // updateOrder() ‚Üí PUT http://localhost:8080/api/orders/:id
      final updatedOrder = await apiService.updateOrder(orderId, amount, userId);
      
      print('‚úÖ OrderProvider: –ó–∞–∫–∞–∑ –æ–±–Ω–æ–≤–ª—ë–Ω: ${updatedOrder.orderId}');
      
      // –ù–∞—Ö–æ–¥–∏–º –∏–Ω–¥–µ–∫—Å —Å—Ç–∞—Ä–æ–≥–æ –∑–∞–∫–∞–∑–∞ –≤ —Å–ø–∏—Å–∫–µ
      final index = orders.indexWhere((order) => order.orderId == orderId);
      
      if (index != -1) {
        // –ó–∞–º–µ–Ω—è–µ–º —Å—Ç–∞—Ä—ã–π –∑–∞–∫–∞–∑ –Ω–∞ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π
        orders[index] = updatedOrder;
      }
      
      // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã –∑–∞–Ω–æ–≤–æ
      applyFilters();
      
      print('‚úÖ OrderProvider: –°–ø–∏—Å–æ–∫ –æ–±–Ω–æ–≤–ª—ë–Ω');
      
    } catch (e, stackTrace) {
      print('‚ùå OrderProvider ERROR: $e');
      print('‚ùå StackTrace: $stackTrace');
      
      errorMessage = e.toString();
      rethrow; // –ü—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º –≤ UI
      
    } finally {
      isLoading = false;
      notifyListeners();
    }
  }

  // ---------------------------------------------------------------------------
  // –ú–ï–¢–û–î: –£–¥–∞–ª–∏—Ç—å –∑–∞–∫–∞–∑
  // ---------------------------------------------------------------------------
  // orderId - ID –∑–∞–∫–∞–∑–∞ –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä: 5)
  
  Future<void> deleteOrder(int orderId) async {
    isLoading = true;
    errorMessage = null;
    notifyListeners();
    
    try {
      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º DELETE –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
      // deleteOrder() ‚Üí DELETE http://localhost:8080/api/orders/:id
      await apiService.deleteOrder(orderId);
      
      // –£–¥–∞–ª—è–µ–º –∑–∞–∫–∞–∑ –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞
      // removeWhere() - —É–¥–∞–ª—è–µ—Ç –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è—é—â–∏–µ —É—Å–ª–æ–≤–∏—é
      // –í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ - –∑–∞–∫–∞–∑ —Å –Ω—É–∂–Ω—ã–º orderId
      orders.removeWhere((order) => order.orderId == orderId);
      
      // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã –∑–∞–Ω–æ–≤–æ (–ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º filtered —Å–ø–∏—Å–æ–∫)
      applyFilters();
      
    } catch (e) {
      errorMessage = e.toString();
      rethrow; // –ü—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º –≤ UI
    } finally {
      isLoading = false;
      notifyListeners();
    }
  }

  // ==========================================================================
  // –ë–õ–û–ö: –ú–ï–¢–û–î–´ –ü–û–ò–°–ö–ê –ò –§–ò–õ–¨–¢–†–ê–¶–ò–ò (Search & Filter Methods)
  // ==========================================================================
  
  // ---------------------------------------------------------------------------
  // –ú–ï–¢–û–î: –ü–æ–∏—Å–∫ –∑–∞–∫–∞–∑–æ–≤ –ø–æ –∫–ª—é—á–µ–≤–æ–º—É —Å–ª–æ–≤—É
  // ---------------------------------------------------------------------------
  // query - —Ç–µ–∫—Å—Ç –∏–∑ SearchBarWidget (–Ω–∞–ø—Ä–∏–º–µ—Ä: "123" –∏–ª–∏ "–ò–≤–∞–Ω")
  // –ò—â–µ—Ç –ø–æ: –Ω–æ–º–µ—Ä—É –∑–∞–∫–∞–∑–∞, –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å—É–º–º–µ –∑–∞–∫–∞–∑–∞
  
  void searchOrders(String query) {
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
    // trim() - —É–±–∏—Ä–∞–µ–º –ø—Ä–æ–±–µ–ª—ã –ø–æ –∫—Ä–∞—è–º ("  123  " ‚Üí "123")
    searchQuery = query.trim();
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –Ω–∞ –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–∏ –Ω–æ–≤–æ–º –ø–æ–∏—Å–∫–µ
    // –ß—Ç–æ–±—ã –Ω–µ –æ—Å—Ç–∞—Ç—å—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ 5 –≥–¥–µ –Ω–∏—á–µ–≥–æ –Ω–µ—Ç
    currentPage = 0;
    
    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é —Å –Ω–æ–≤—ã–º –∑–∞–ø—Ä–æ—Å–æ–º
    applyFilters();
    
    // –£–≤–µ–¥–æ–º–ª—è–µ–º UI —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å
    notifyListeners();
  }

  // ---------------------------------------------------------------------------
  // –ú–ï–¢–û–î: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
  // ---------------------------------------------------------------------------
  // userId - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ null (–ø–æ–∫–∞–∑–∞—Ç—å –∑–∞–∫–∞–∑—ã –≤—Å–µ—Ö)
  
  void filterByUser(int? userId) {
    selectedUserId = userId;
    currentPage = 0;
    applyFilters();
    notifyListeners();
  }

  // ---------------------------------------------------------------------------
  // –ú–ï–¢–û–î: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
  // ---------------------------------------------------------------------------
  // –ö–æ–º–±–∏–Ω–∏—Ä—É–µ—Ç —Ñ–∏–ª—å—Ç—Ä –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é + –ø–æ–∏—Å–∫
  // –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
  
  void applyFilters() {
    // –®–∞–≥ 1: –ù–∞—á–∏–Ω–∞–µ–º —Å–æ –≤—Å–µ—Ö –∑–∞–∫–∞–∑–æ–≤
    List<OrderModel> result = List.from(orders);
    
    // –®–∞–≥ 2: –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (–µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω)
    if (selectedUserId != null) {
      // where() - —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–æ —É—Å–ª–æ–≤–∏—é
      // –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –∑–∞–∫–∞–∑—ã –≥–¥–µ userForeignKey == –≤—ã–±—Ä–∞–Ω–Ω—ã–π ID
      result = result
          .where((order) => order.userForeignKey == selectedUserId)
          .toList();
    }
    
    // –®–∞–≥ 3: –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–æ–∏—Å–∫–æ–≤—ã–π —Ñ–∏–ª—å—Ç—Ä (–µ—Å–ª–∏ –µ—Å—Ç—å –∑–∞–ø—Ä–æ—Å)
    if (searchQuery.isNotEmpty) {
      result = result.where((order) {
        // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º orderId –≤ —Å—Ç—Ä–æ–∫—É –¥–ª—è –ø–æ–∏—Å–∫–∞
        // toString() - 123 ‚Üí "123"
        // contains() - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Ö–æ–∂–¥–µ–Ω–∏–µ –ø–æ–¥—Å—Ç—Ä–æ–∫–∏
        
        // –ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É –∑–∞–∫–∞–∑–∞
        final orderIdMatch = order.orderId
            .toString()
            .toLowerCase()
            .contains(searchQuery.toLowerCase());
        
        // –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–µ—Å–ª–∏ –ø–æ–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ)
        final userNameMatch = order.userName != null
            ? order.userName!
                .toLowerCase()
                .contains(searchQuery.toLowerCase())
            : false; // –ï—Å–ª–∏ userName == null, —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –Ω–µ—Ç
        
        // –ü–æ–∏—Å–∫ –ø–æ —Å—É–º–º–µ –∑–∞–∫–∞–∑–∞
        final amountMatch = order.orderAmount
            .toString()
            .contains(searchQuery);
        
        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º true –µ—Å–ª–∏ –•–û–¢–Ø –ë–´ –û–î–ù–û —É—Å–ª–æ–≤–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
        // || - –ª–æ–≥–∏—á–µ—Å–∫–æ–µ –ò–õ–ò (OR)
        return orderIdMatch || userNameMatch || amountMatch;
        
      }).toList();
    }
    
    // –®–∞–≥ 4: –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ filteredOrders
    filteredOrders = result;
  }

  // ---------------------------------------------------------------------------
  // –ú–ï–¢–û–î: –°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã
  // ---------------------------------------------------------------------------
  // –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤ –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–≤—Å–µ –∑–∞–∫–∞–∑—ã)
  
  void clearFilters() {
    searchQuery = '';           // –û—á–∏—â–∞–µ–º –ø–æ–∏—Å–∫
    selectedUserId = null;      // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–∏–ª—å—Ç—Ä –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    currentPage = 0;            // –ù–∞ –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
    filteredOrders = List.from(orders); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –∑–∞–∫–∞–∑—ã
    notifyListeners();
  }

  // ==========================================================================
  // –ë–õ–û–ö: –ú–ï–¢–û–î–´ –ü–ê–ì–ò–ù–ê–¶–ò–ò (Pagination Methods)
  // ==========================================================================
  
  // ---------------------------------------------------------------------------
  // –ú–ï–¢–û–î: –°–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
  // ---------------------------------------------------------------------------
  
  void nextPage() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º: –Ω–µ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π –ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–µ?
    // totalPages - 1 –ø–æ—Ç–æ–º—É —á—Ç–æ –Ω—É–º–µ—Ä–∞—Ü–∏—è —Å 0
    if (currentPage < totalPages - 1) {
      currentPage++; // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      notifyListeners(); // –û–±–Ω–æ–≤–ª—è–µ–º UI
    }
  }

  // ---------------------------------------------------------------------------
  // –ú–ï–¢–û–î: –ü—Ä–µ–¥—ã–¥—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
  // ---------------------------------------------------------------------------
  
  void previousPage() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º: –Ω–µ –Ω–∞ –ø–µ—Ä–≤–æ–π –ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–µ?
    if (currentPage > 0) {
      currentPage--; // –£–º–µ–Ω—å—à–∞–µ–º –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      notifyListeners();
    }
  }

  // ---------------------------------------------------------------------------
  // –ú–ï–¢–û–î: –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
  // ---------------------------------------------------------------------------
  // page - –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã (0, 1, 2, ...)
  
  void goToPage(int page) {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤–∞–ª–∏–¥–Ω—ã–π
    // page >= 0 - –Ω–µ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π
    // page < totalPages - –Ω–µ –±–æ–ª—å—à–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å—Ç—Ä–∞–Ω–∏—Ü
    if (page >= 0 && page < totalPages) {
      currentPage = page;
      notifyListeners();
    }
  }

  // ==========================================================================
  // –ë–õ–û–ö: –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –ú–ï–¢–û–î–´ (Helper Methods)
  // ==========================================================================
  
  // ---------------------------------------------------------------------------
  // –ú–ï–¢–û–î: –û—á–∏—Å—Ç–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
  // ---------------------------------------------------------------------------
  // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø–æ–∫–∞–∑–∞ –æ—à–∏–±–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
  
  void clearError() {
    errorMessage = null;
    notifyListeners();
  }
}
