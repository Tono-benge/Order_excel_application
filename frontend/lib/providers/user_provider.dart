//(State Management –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π - Frontend)
//–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. Provider –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–≤–µ–¥–æ–º–ª—è–µ—Ç UI –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –¥–∞–Ω–Ω—ã—Ö
// ========== –ò–ú–ü–û–†–¢–´ ==========
import 'package:flutter/foundation.dart'; // –î–ª—è ChangeNotifier (–æ—Å–Ω–æ–≤–∞ Provider)
import '../models/user_model.dart';       // –ú–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
import '../services/api_service.dart';    // –î–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ —Å–µ—Ä–≤–µ—Ä—É


// Provider –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
// ChangeNotifier - —ç—Ç–æ –∫–ª–∞—Å—Å, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª—è—Ç—å —Å–ª—É—à–∞—Ç–µ–ª–µ–π –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
class UserProvider with ChangeNotifier {
  
  // ========== –ü–†–ò–í–ê–¢–ù–´–ï –ü–û–õ–Ø (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ) ==========
  
  final ApiService _apiService = ApiService(); // –≠–∫–∑–µ–º–ø–ª—è—Ä API —Å–µ—Ä–≤–∏—Å–∞
  
  List<UserModel> _users = [];              // –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  List<UserModel> _filteredUsers = [];      // –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ (–¥–ª—è –ø–æ–∏—Å–∫–∞)
  bool _isLoading = false;                  // –§–ª–∞–≥ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
  String? _errorMessage;                    // –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ (–µ—Å–ª–∏ –µ—Å—Ç—å)
  String _searchQuery = '';                 // –¢–µ–∫—É—â–∏–π –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
  
  // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
  int _currentPage = 0;                     // –¢–µ–∫—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 0)
  final int _itemsPerPage = 10;             // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ


  // ========== –ü–£–ë–õ–ò–ß–ù–´–ï –ì–ï–¢–¢–ï–†–´ (–¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º –∏–∑–≤–Ω–µ) ==========
  
  // –ì–µ—Ç—Ç–µ—Ä - —ç—Ç–æ –º–µ—Ç–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –ø–æ–ª—è
  // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö, –Ω–æ –Ω–µ –¥–ª—è –∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞–ø—Ä—è–º—É—é
  
  List<UserModel> get users => _users;                    // –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
  List<UserModel> get filteredUsers => _filteredUsers;    // –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
  bool get isLoading => _isLoading;                       // –ò–¥–µ—Ç –ª–∏ –∑–∞–≥—Ä—É–∑–∫–∞
  String? get errorMessage => _errorMessage;              // –¢–µ–∫—Å—Ç –æ—à–∏–±–∫–∏
  String get searchQuery => _searchQuery;                 // –ü–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
  int get currentPage => _currentPage;                    // –ù–æ–º–µ—Ä —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  int get itemsPerPage => _itemsPerPage;                  // –≠–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
  
  // –í—ã—á–∏—Å–ª—è–µ–º—ã–π –≥–µ—Ç—Ç–µ—Ä: –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü
  // –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞: –¥–µ–ª–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ —Ä–∞–∑–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –æ–∫—Ä—É–≥–ª—è–µ–º –≤–≤–µ—Ä—Ö
  int get totalPages => (_filteredUsers.length / _itemsPerPage).ceil();
  
  // –í—ã—á–∏—Å–ª—è–µ–º—ã–π –≥–µ—Ç—Ç–µ—Ä: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  // –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–π "–∫—É—Å–æ–∫" –∏–∑ –æ–±—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
  List<UserModel> get paginatedUsers {
    final startIndex = _currentPage * _itemsPerPage; // –ù–∞—á–∞–ª–æ —Å—Ä–µ–∑–∞
    final endIndex = (startIndex + _itemsPerPage).clamp(0, _filteredUsers.length); // –ö–æ–Ω–µ—Ü —Å—Ä–µ–∑–∞
    
    // –ú–µ—Ç–æ–¥ sublist() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–¥—Å–ø–∏—Å–æ–∫ –æ—Ç startIndex –¥–æ endIndex
    return _filteredUsers.sublist(startIndex, endIndex);
  }


  // ========== –ú–ï–¢–û–î–´ –î–õ–Ø –†–ê–ë–û–¢–´ –° –î–ê–ù–ù–´–ú–ò ==========


  // –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Å–µ—Ä–≤–µ—Ä–∞
  Future<void> fetchUsers() async {
    _isLoading = true;              // –í–∫–ª—é—á–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
    _errorMessage = null;           // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é –æ—à–∏–±–∫—É
    notifyListeners();              // –£–≤–µ–¥–æ–º–ª—è–µ–º UI –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö (–ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–ª–æ–∞–¥–µ—Ä)
    
    try {
      // –î–µ–ª–∞–µ–º –∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É —á–µ—Ä–µ–∑ API —Å–µ—Ä–≤–∏—Å
      _users = await _apiService.getUsers();
      
      // –ö–æ–ø–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫ –≤ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–π (–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ—Ö)
      _filteredUsers = List.from(_users);
      
      _currentPage = 0;             // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –Ω–∞ –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
      
    } catch (e) {
      // –ï—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞, —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
      _errorMessage = e.toString();
      _users = [];
      _filteredUsers = [];
    } finally {
      // finally –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—Å–µ–≥–¥–∞ (–¥–∞–∂–µ –µ—Å–ª–∏ –±—ã–ª–∞ –æ—à–∏–±–∫–∞)
      _isLoading = false;           // –í—ã–∫–ª—é—á–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
      notifyListeners();            // –£–≤–µ–¥–æ–º–ª—è–µ–º UI (–æ–±–Ω–æ–≤–∏—Ç—å —ç–∫—Ä–∞–Ω)
    }
  }


  // –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  Future<void> createUser(String fullName) async {
    _isLoading = true;
    _errorMessage = null;
    notifyListeners();   
    try {
      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ
      final newUser = await _apiService.createUser(fullName);
      
      // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫
      _users.add(newUser);
      
      // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π –ø–æ–∏—Å–∫–æ–≤—ã–π —Ñ–∏–ª—å—Ç—Ä –∑–∞–Ω–æ–≤–æ
      _applySearchFilter();
      
    } catch (e) {
      _errorMessage = e.toString();
      rethrow; // –ü—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –≤—ã—à–µ (–≤ UI) –¥–ª—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    } finally {
      _isLoading = false;
      notifyListeners();
    }
  }


  // ============================================================================
  // ‚úÖ –ù–û–í–´–ô –ú–ï–¢–û–î: –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  // ============================================================================
  // userId - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
  // fullName - –Ω–æ–≤–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  
  Future<void> updateUser(int userId, String fullName) async {
    _isLoading = true;
    _errorMessage = null;
    notifyListeners();
    
    try {
      print('üìù UserProvider: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ID: $userId');
      
      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º PUT –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ ApiService
      final updatedUser = await _apiService.updateUser(userId, fullName);
      
      print('‚úÖ UserProvider: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–±–Ω–æ–≤–ª—ë–Ω: ${updatedUser.fullName}');
      
      // –ù–∞—Ö–æ–¥–∏–º –∏–Ω–¥–µ–∫—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å–ø–∏—Å–∫–µ
      final index = _users.indexWhere((user) => user.id == userId);
      
      if (index != -1) {
        // –ó–∞–º–µ–Ω—è–µ–º —Å—Ç–∞—Ä–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–≥–æ
        _users[index] = updatedUser;
      }
      
      // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–æ–∏—Å–∫–æ–≤—ã–π —Ñ–∏–ª—å—Ç—Ä –∑–∞–Ω–æ–≤–æ
      _applySearchFilter();
      
      print('‚úÖ UserProvider: –°–ø–∏—Å–æ–∫ –æ–±–Ω–æ–≤–ª—ë–Ω');
      
    } catch (e, stackTrace) {
      print('‚ùå UserProvider ERROR: $e');
      print('‚ùå StackTrace: $stackTrace');
      
      _errorMessage = e.toString();
      rethrow; // –ü—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º –≤ UI
      
    } finally {
      _isLoading = false;
      notifyListeners();
    }
  }


  // –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –∏–º–µ–Ω–∏ (–ª–æ–∫–∞–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è)
  void searchUsers(String query) {
    _searchQuery = query.trim();    // –£–±–∏—Ä–∞–µ–º –ø—Ä–æ–±–µ–ª—ã –ø–æ –∫—Ä–∞—è–º
    _currentPage = 0;               // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
    _applySearchFilter();           // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä
    notifyListeners();              // –û–±–Ω–æ–≤–ª—è–µ–º UI
  }


  // –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞
  void _applySearchFilter() {
    if (_searchQuery.isEmpty) {
      // –ï—Å–ª–∏ –ø–æ–∏—Å–∫ –ø—É—Å—Ç–æ–π, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ—Ö
      _filteredUsers = List.from(_users);
    } else {
      // –§–∏–ª—å—Ç—Ä—É–µ–º —Å–ø–∏—Å–æ–∫: –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ—Ö, —É –∫–æ–≥–æ –∏–º—è —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–ø—Ä–æ—Å
      _filteredUsers = _users.where((user) {
        return user.fullName
            .toLowerCase()                           // –ü—Ä–∏–≤–æ–¥–∏–º –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É
            .contains(_searchQuery.toLowerCase());   // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Ö–æ–∂–¥–µ–Ω–∏–µ
      }).toList();
    }
  }


  // –°–±—Ä–æ—Å–∏—Ç—å –ø–æ–∏—Å–∫ (–ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
  void clearSearch() {
    _searchQuery = '';
    _currentPage = 0;
    _filteredUsers = List.from(_users);
    notifyListeners();
  }


  // ========== –ú–ï–¢–û–î–´ –ü–ê–ì–ò–ù–ê–¶–ò–ò ==========


  // –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
  void nextPage() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø–æ—Å–ª–µ–¥–Ω—è—è –ª–∏ —ç—Ç–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞
    if (_currentPage < totalPages - 1) {
      _currentPage++;
      notifyListeners(); // –û–±–Ω–æ–≤–ª—è–µ–º UI —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ–π
    }
  }


  // –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
  void previousPage() {
    if (_currentPage > 0) {
      _currentPage--;
      notifyListeners();
    }
  }


  // –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
  void goToPage(int page) {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤–∞–ª–∏–¥–µ–Ω
    if (page >= 0 && page < totalPages) {
      _currentPage = page;
      notifyListeners();
    }
  }


  // –°–±—Ä–æ—Å–∏—Ç—å –æ—à–∏–±–∫—É
  void clearError() {
    _errorMessage = null;
    notifyListeners();
  }
  // ============================================================================
  // –ú–ï–¢–û–î: –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  // ============================================================================
  // userId - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
  
  Future<void> deleteUser(int userId) async {
    _isLoading = true;
    _errorMessage = null;
    notifyListeners();
    
    try {
      print('üóëÔ∏è UserProvider: –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ID: $userId');
      
      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º DELETE –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ ApiService
      await _apiService.deleteUser(userId);
      
      print('‚úÖ UserProvider: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª—ë–Ω —Å —Å–µ—Ä–≤–µ—Ä–∞');
      
      // –£–¥–∞–ª—è–µ–º –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞
      _users.removeWhere((user) => user.id == userId);
      
      // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–æ–∏—Å–∫–æ–≤—ã–π —Ñ–∏–ª—å—Ç—Ä –∑–∞–Ω–æ–≤–æ
      _applySearchFilter();
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Ç–µ–∫—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –ø—É—Å—Ç–∞—è
      // –ï—Å–ª–∏ —É–¥–∞–ª–∏–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ - –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é
      if (_filteredUsers.isNotEmpty && _currentPage > 0) {
        final maxPage = totalPages - 1;
        if (_currentPage > maxPage) {
          _currentPage = maxPage;
        }
      }
      
      print('‚úÖ UserProvider: –°–ø–∏—Å–æ–∫ –æ–±–Ω–æ–≤–ª—ë–Ω');
      
    } catch (e, stackTrace) {
      print('‚ùå UserProvider ERROR: $e');
      print('‚ùå StackTrace: $stackTrace');
      
      _errorMessage = e.toString();
      rethrow; // –ü—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º –≤ UI
      
    } finally {
      _isLoading = false;
      notifyListeners();
    }
  }

} // ‚Üê –ó–∞–∫—Ä—ã–≤–∞—é—â–∞—è —Å–∫–æ–±–∫–∞ –∫–ª–∞—Å—Å–∞ UserProvider




